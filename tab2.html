<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRIPT 2</title>
    <!-- CSS de Select2 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" />

    <style>
        #lista-folios li {
            list-style: none;
            margin-bottom: 5px;
        }

        #lista-folios li a {
            color: #007bff;
            text-decoration: underline;
            cursor: pointer;
        }

        #lista-folios li a:hover {
            color: #0056b3;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 25px;
		
        }
        .container {
            display: grid;
            grid-template-columns: 150px 1fr 1fr .1fr; /* Primera columna peque√±a, las otras dos iguales */
            gap: 20px;
            max-width: 1500px;
            margin: auto;
		
        }
        .form-container {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 1500px; /* Ajusta la altura m√°xima seg√∫n sea necesario */
            overflow-y: auto;  /* Permite el desplazamiento vertical */
        }
        .centrar-pantalla {
            display: flex;
            border: 1px solid #ddd;
            flex-direction: column;  /* Para que los elementos se apilen verticalmente */
            justify-content: center; /* Centrado vertical */
            height: 100vh;
            background-color: #cacacaab; /* Solo para que se vea el fondo */
        }
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
 		overflow-y: auto;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .form-container .block {
            margin-bottom: 20px; /* Espacio entre bloques */
        }
        .form-container .block:last-of-type {
            margin-bottom: 0; /* El √∫ltimo bloque no necesita margen inferior */
        }
        .text-preview {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            font-family: monospace;
            white-space: pre-wrap; /* Mantiene los espacios en blanco */
            font-size: 16px;
		    max-height: 1200px; /* Ajusta la altura m√°xima seg√∫n sea necesario */
            overflow-y: auto;  /* Permite el desplazamiento vertical */
        }
        .select2-container {
            width: 100% !important;
        }

    </style>

</head>
<body>    


    <div class="container">
        <!-- Contenedor del formulario -->
            
        <div class="centrar-pantalla">
    <!--BUSCAR POR SD-->
                <h3>Buscar por SD</h3>
                <input type="text" id="buscarId" placeholder="SD del corte">
                    <button onclick="buscar()">Buscar</button>  
                    <button type="button" onclick="limpiarSeleccion()">Limpiar</button>
                    <br>
                    <br>
                    <h3 style="font-size: 16px;">√öltimos 10 folios registrados</h3>
                        <ul id="lista-folios"></ul>
                    <br>
                    <br>
                   <button type="submit" form="modificar-form">Guardar</button>
        </div>

        <div class="form-container">
            <h2>Modificar Informaci√≥n</h2>

        <!--<label for="fecha">Selecciona una fecha:</label>
        <input type="date" id="fecha" name="fecha">
        
        <input type="text" id="fecha-texto" name="fecha-texto" readonly>-->

            <form id="modificar-form">
                


                <!-- Primer Bloque -->
                <div class="block">
                    <h3>ETA</h3>
                    <div class="form-group">
                        <label for="folio">FOLIO:</label>
                        <input type="text" id="folio_" name="folio_" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="eta">ETA:</label>
                        <input type="text" id="eta" name="eta" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="proveedor">PROVEEDOR:</label>
                        <input type="text" id="proveedor" name="proveedor" onblur="this.value = this.value.trim()">
                    </div>
                </div>

                <!-- Segundo Bloque -->
                <div class="block">
                    <h3>SCRIPT SITIO</h3>
                    <div class="form-group">
                        <label for="sd">SD:</label>
                        <input type="text" id="sd" name="sd" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="punto">Sitio/punto de medici√≥n:</label>
                        <input type="text" id="punto" name="punto" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="coordenadas">Coordenadas:</label>
                        <input type="text" id="coordenadas" name="coordenadas" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="proveedor2">Proveedor:</label>
                        <input type="text" id="proveedor2" name="proveedor2" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="distrito">Distrito:</label>
                        <input type="text" id="distrito" name="distrito" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="nombre">Nombre:</label>
 			            <select id="nombre" name="nombre">         			
                                        <!---SELECT DE TECNICOS-->
                        </select>
                    </div>
                    <!-- JavaScript de Select2 -->
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>

                    <script>
                        // Inicializa Select2
                    
                    </script>
                    
                </div>
                <!-- Tercer Bloque -->
                <div class="block">
                    <h3>SCRIPT FALLO</h3>
                    <div class="form-group">
                        <label for="folio3_">Folio:</label>
                        <input type="text" id="folio3_" name="folio3_" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="causa">Causa del da√±o:</label>
                        <input type="text" id="causa" name="causa" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="accion">Acci√≥n correctiva:</label>
                        <input type="text" id="accion" name="accion" onblur="this.value = this.value.trim()">
                    </div>
                     <div class="form-group">
                        <label for="etr">ETR:</label>
                        <input type="text" id="etr" name="etr" onblur="this.value = this.value.trim()">
                    </div>                   
                    <div class="form-group">
                        <label for="calibre">Capacidad de FO</label>
                        <input type="text" id="calibre" name="calibre" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="coordenadas3">Coordenadas:</label>
                        <input type="text" id="coordenadas3" name="coordenadas3" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="qr">Numero QR:</label>
                        <input type="text" id="qr" name="qr" onblur="this.value = this.value.trim()">
                    </div>
                     <div class="form-group">
                        <label for="materiales">Materiales a utilizar:</label>
                        <input type="text" id="materiales" name="materiales" onblur="this.value = this.value.trim()">
                    </div>                   
                </div>

                <!-- Cuarto Bloque -->
                <div class="block">
                    <h3>SCRIPT FINAL</h3>
                    <div class="form-group">
                        <label for="folio4">FOLIO:</label>
                        <input type="text" id="folio4" name="folio4" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="ciudad">CIUDAD:</label>
                        <input type="text" id="ciudad" name="ciudad" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="estado">ESTADO:</label>
                        <input type="text" id="estado" name="estado" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="cluster">CLUSTER:</label>
                          <select id="cluster" name="cluster" onchange="llenarNumero()">
                                <option value="">Selecciona una opci√≥n</option>
                                <option value="ALDAMA">ALDAMA</option>
                                <option value="ALDAMA_2">ALDAMA_2</option>
                                <option value="BUENOS AIRES">BUENOS AIRES</option>
                                <option value="BUENOS AIRES 2">BUENOS AIRES 2</option>
                                <option value="CARLOS AMAYA">CARLOS AMAYA</option>
                                <option value="EL VERGEL">EL VERGEL</option>
                                <option value="GOMEZ MORIN">GOMEZ MORIN</option>
                                <option value="LOMAS DE MORELOS">LOMAS DE MORELOS</option>
                                <option value="LOS CIPRESES">LOS CIPRESES</option>
                                <option value="MAYORCA">MAYORCA</option>
                                <option value="NOGALES">NOGALES</option>
                                <option value="OASIS">OASIS</option>
                                <option value="SANTO DOMINGO">SANTO DOMINGO</option>
                                <option value="THOMPSON">THOMPSON</option>
                                <option value="THOMPSON 2">THOMPSON 2</option>
                                <option value="TIERRA NUEVA">TIERRA NUEVA</option>
                                <option value="TIERRA NUEVA 2">TIERRA NUEVA 2</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="olt">OLT:</label>
                         <input type="text" id="olt" placeholder="Se llenar√° autom√°ticamente" name="olt">
                    </div>
                    <div class="form-group">
                        <label for="clientes">CLIENTES AFECTADOS:</label>
                        <input type="text" id="clientes" name="clientes" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="clientes">FALLA REPORTADA:</label>
                        <input type="text" id="falla_r" name="falla_r" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="fecha">Selecciona una fecha:</label>
                        <input type="date" id="fecha" name="fecha"  >
                        <input type="hidden" id="fecha-texto" name="fecha-texto" readonly onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="hr_desp">FECHA_Y_HR_DE_ASG_DESP:</label>
                        <input type="text" id="hr_desp" name="hr_desp" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="hr_prov">FECHA_Y_HR_DE_ASG_PROV:</label>
                        <input type="text" id="hr_prov" name="hr_prov" onblur="this.value = this.value.trim()">
                    </div>                    
                    <div class="form-group">
                        <label for="hr_llegada">HR_DE_LLEGADA_A_LA_ZONA:</label>
                        <input type="text" id="hr_llegada" name="hr_llegada" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="hr_med">HR_DE_LA_1er_MEDICION:</label>
                        <input type="text" id="hr_med" name="hr_med" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="ubicacion_1er_2do">UBICACI√ìN_DE_1N_2N:</label>
                        <input type="text" id="ubicacion_1er_2do" name="ubicacion_1er_2do" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="qr_2">QR DE SEGUNDO NIVEL:</label>
                        <input type="text" id="qr_2" name="qr_2" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="causa_dano">CAUSA DE DA√ëO:</label>
                        <input type="text" id="causa_dano" name="causa_dano" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="ubicacion_dano">UBICACI√ìN_DEL_DA√ëO:</label>
                        <input type="text" id="ubicacion_dano" name="ubicacion_dano" onblur="this.value = this.value.trim()">
                    </div>                   
                    <div class="form-group">
                        <label for="coordenadas_dano">COORDENADAS:</label>
                        <input type="text" id="coordenadas_dano" name="coordenadas_dano" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="desc_act">DESCRIP_DE_ACTIVIDADES:</label>
                        <input type="text" id="desc_act" name="desc_act" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="potencia_inicial">POTENCIA_INICIAL:</label>
                        <input type="text" id="potencia_inicial" name="potencia_inicial" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="potencia_final">POTENCIA_FINAL:</label>
                        <input type="text" id="potencia_final" name="potencia_final" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="trabajos_realizados">TRABAJOS_REALIZADOS:</label>
                        <input type="text" id="trabajos_realizados" name="trabajos_realizados" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="hr_final">FECHA_HR_FINAL_DE_REPARACION::</label>
                        <input type="text" id="hr_final" name="hr_final" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="atiende_nom_tec">ATIENDE_NOM_TEC:</label>
                        <input type="text" id="atiende_nom_tec" name="atiende_nom_tec" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="proveedor4">PROVEEDOR:</label>
                        <input type="text" id="proveedor4" name="proveedor4" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="supervisor">SUPERVISOR DISTRITO:</label>
                        <select id="supervisor" name="supervisor">
                            <option value="Jesus Eduardo Rodriguez Hernandez">Jesus Eduardo Rodriguez Hernandez</option>
                            <option value="Jorge Alberto Robles Cortez">Jorge Alberto Robles Cortez</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="justificacion_sla">PAUSA HORA INICIAL Y FINAL:</label>
                        <input type="text" id="justificacion_sla" name="justificacion_sla" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="motivo_pausa">MOTIVO DE PAUSA:</label>
                        <input type="text" id="m_pausa" name="m_pausa" onblur="this.value = this.value.trim()">
                    </div>
                    <div class="form-group">
                        <label for="tiempo_pausa">TIEMPO TOTAL DE PAUSA:</label>
                        <input type="text" id="t_pausa" name="t_pausa" onblur="this.value = this.value.trim()">
                    </div>                    
                    <div class="form-group">
                        <label for="material_utilizado">MATERIAL UTILIZADO:</label>
                        <input type="text" id="material_utilizado" name="material_utilizado" onblur="this.value = this.value.trim()">
                    </div>
                </div>


                         <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script>
        // Tu configuraci√≥n de Firebase (reemplaza con la tuya)
        const firebaseConfig = {
            apiKey: "AIzaSyD63qvgPWjAF7wDB1o4O3sgvDU0PtAwHb8",
            authDomain: "scripts-2c739.firebaseapp.com",
            projectId: "scripts-2c739",
            storageBucket: "scripts-2c739.firebasestorage.app",
            messagingSenderId: "1054970007452",
            appId: "1:1054970007452:web:1d283693bb8377192c0259",
            measurementId: "G-08TE213QDH"
        };
        // Inicializar Firebase
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
        // Referencia al formulario
            const form = document.getElementById("modificar-form");

        form.addEventListener("submit", async function(e) {
            e.preventDefault();

            const folio = document.getElementById("folio_").value.trim();
            const eta = document.getElementById("eta").value;
            const proveedor = document.getElementById("proveedor").value;

            const punto = document.getElementById("punto").value;
            const coordenadas = document.getElementById("coordenadas").value;
            const proveedor2 = document.getElementById("proveedor2").value;
            const distrito = document.getElementById("distrito").value;
            const nombre = document.getElementById("nombre").value; //REVISAR LABEL DE NOMBRE IDC

            const causa = document.getElementById("causa").value;
            const accion = document.getElementById("accion").value;
            const etr = document.getElementById("etr").value;
            const calibre = document.getElementById("calibre").value;
            const coordenadas3 = document.getElementById("coordenadas3").value;
            const qr = document.getElementById("qr").value;
            const materiales = document.getElementById("materiales").value;

            const ciudad = document.getElementById("ciudad").value;
            const estado = document.getElementById("estado").value;
            const cluster = document.getElementById("cluster").value;
            const olt = document.getElementById("olt").value;
            const clientes = document.getElementById("clientes").value;
            const falla_r = document.getElementById("falla_r").value;
            const fecha = document.getElementById("fecha-texto").value;
            const hr_desp = document.getElementById("hr_desp").value;
            const hr_prov = document.getElementById("hr_prov").value;
            const hr_llegada = document.getElementById("hr_llegada").value;
            const hr_med = document.getElementById("hr_med").value;
            const ubicacion_1er_2do = document.getElementById("ubicacion_1er_2do").value;
            const qr_2 = document.getElementById("qr_2").value;
            const causa_dano = document.getElementById("causa_dano").value;
            const ubicacion_dano = document.getElementById("ubicacion_dano").value;
            const desc_act = document.getElementById("desc_act").value;
            const potencia_inicial = document.getElementById("potencia_inicial").value;
            const potencia_final = document.getElementById("potencia_final").value;
            const coordenadas_dano = document.getElementById("coordenadas_dano").value;
            const trabajos_realizados = document.getElementById("trabajos_realizados").value;
            const hr_final = document.getElementById("hr_final").value;
            const atiende_nom_tec = document.getElementById("atiende_nom_tec").value;
            const proveedor4 = document.getElementById("proveedor4").value;
            const supervisor = document.getElementById("supervisor").value;
            const justificacion_sla = document.getElementById("justificacion_sla").value;
            const m_pausa = document.getElementById("m_pausa").value;
            const t_pausa = document.getElementById("t_pausa").value;
            const material_utilizado = document.getElementById("material_utilizado").value;


            if (!folio) return alert("Debes ingresar un SD");

            try {
                await db.collection("usuarios").doc(folio).set({folio, eta, proveedor, punto, coordenadas, proveedor2, distrito, nombre,
                                                                causa, accion, etr, calibre, coordenadas3, qr, materiales,
                                                                ciudad, estado, cluster, olt, clientes, falla_r, hr_desp, hr_prov,
                                                                hr_llegada, hr_med, ubicacion_1er_2do, qr_2, 
                                                                causa_dano, ubicacion_dano, coordenadas_dano, desc_act, potencia_inicial, potencia_final, trabajos_realizados, hr_final,
                                                                atiende_nom_tec, proveedor4, supervisor,
                                                                justificacion_sla, m_pausa, t_pausa, material_utilizado, timestamp: firebase.firestore.FieldValue.serverTimestamp()});
                                                                
                alert("Datos guardados con folio: " + folio);
                 cargarUltimosFolios(); 
                //form.reset();
            } catch (error) {
                console.error("Error al guardar:", error);
            }
        });

        async function buscar() {
      const id = document.getElementById("buscarId").value.trim();
      //const resultado = document.getElementById("resultado");

      if (!id) return alert("Ingresa un ID v√°lido.");

      try {
        const doc = await db.collection("usuarios").doc(id).get();

        if (doc.exists) {
          const datos = doc.data();
            document.getElementById("folio_").value = datos.folio || "";
            document.getElementById("eta").value = datos.eta || "";
            document.getElementById("proveedor").value = datos.proveedor || "";

            document.getElementById("punto").value = datos.punto || "";
            document.getElementById("coordenadas").value = datos.coordenadas || "";
            document.getElementById("proveedor2").value = datos.proveedor2 || "";
            document.getElementById("distrito").value = datos.distrito || "";
            document.getElementById("nombre").value = datos.nombre || ""; //REVISAR LABEL DE NOMBRE IDC

            document.getElementById("causa").value = datos.causa || "";
            document.getElementById("accion").value = datos.accion || "";
            document.getElementById("etr").value = datos.etr || "";
            document.getElementById("calibre").value = datos.calibre || "";
            document.getElementById("coordenadas3").value = datos.coordenadas3 || "";
            document.getElementById("qr").value = datos.qr || "";
            document.getElementById("materiales").value = datos.materiales || "";

            document.getElementById("ciudad").value = datos.ciudad || "";
            document.getElementById("estado").value = datos.estado || "";
            document.getElementById("cluster").value = datos.cluster || "";
            document.getElementById("olt").value = datos.olt || "";
            document.getElementById("clientes").value = datos.clientes || "";
            document.getElementById("falla_r").value = datos.falla_r || "";
            document.getElementById("fecha-texto").value = datos.fecha || "";
            document.getElementById("hr_desp").value = datos.hr_desp || "";
            document.getElementById("hr_prov").value = datos.hr_prov || "";
            document.getElementById("hr_llegada").value = datos.hr_llegada || "";
            document.getElementById("hr_med").value = datos.hr_med || "";
            document.getElementById("ubicacion_1er_2do").value = datos.ubicacion_1er_2do || "";
            document.getElementById("qr_2").value = datos.qr_2 || "";
            document.getElementById("causa_dano").value = datos.causa_dano || "";
            document.getElementById("ubicacion_dano").value = datos.ubicacion_dano || "";
            document.getElementById("coordenadas_dano").value = datos.coordenadas_dano || "";
            document.getElementById("desc_act").value = datos.desc_act || "";
            document.getElementById("potencia_inicial").value = datos.potencia_inicial || "";
            document.getElementById("potencia_final").value = datos.potencia_final || "";
            document.getElementById("trabajos_realizados").value = datos.trabajos_realizados || "";
            document.getElementById("hr_final").value = datos.hr_final || "";
            document.getElementById("atiende_nom_tec").value = datos.atiende_nom_tec || "";
            document.getElementById("proveedor4").value = datos.proveedor4 || "";
            document.getElementById("supervisor").value = datos.supervisor || "";
            document.getElementById("justificacion_sla").value = datos.justificacion_sla || "";
            document.getElementById("m_pausa").value = datos.m_pausa || "";
            document.getElementById("t_pausa").value = datos.t_pausa || "";
            document.getElementById("material_utilizado").value = datos.material_utilizado || "";
          //resultado.innerText = "Datos cargados.";
          updatePreview();
        } else {
         // resultado.innerText = "Documento no encontrado.";
         alert("SD NO EXISTE");
        }
      } catch (error) {
        //resultado.innerText = "Error al buscar.";
        alert("ERROR AL BUSCAR");
      }
    }
    //----------------------------CARGAR 1O ULTIMOS FOLIOS---------------------------------}
async function cargarUltimosFolios() {
  const lista = document.getElementById("lista-folios");
  lista.innerHTML = "<li>Cargando...</li>";

  try {
    const querySnapshot = await db.collection("usuarios")
      .orderBy("timestamp", "desc")
      .limit(10)
      .get();

    lista.innerHTML = "";

    querySnapshot.forEach((doc) => {
      const datos = doc.data();
      const folio = datos.folio || doc.id;

      const li = document.createElement("li");

      const link = document.createElement("a");
      link.textContent = folio;
      link.style.marginRight = "10px";
      link.style.color = "#007bff";
      link.style.textDecoration = "underline";
      link.style.cursor = "pointer";
      link.onclick = () => {
        document.getElementById("buscarId").value = folio;
        buscar();
      };

      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "üóëÔ∏è";
      btnEliminar.title = "Eliminar este folio";
      btnEliminar.style.color = "red";
      btnEliminar.style.border = "none";
      btnEliminar.style.background = "none";
      btnEliminar.style.cursor = "pointer";
      btnEliminar.onclick = async () => {
        if (confirm(`¬øEliminar el folio "${folio}"?`)) {
          try {
            await db.collection("usuarios").doc(folio).delete();
            alert(`Folio "${folio}" eliminado`);
            cargarUltimosFolios(); // üîÑ actualizar lista
          } catch (err) {
            alert("Error al eliminar");
            console.error(err);
          }
        }
      };

      li.appendChild(link);
      li.appendChild(btnEliminar);
      lista.appendChild(li);
    });

    if (querySnapshot.empty) {
      lista.innerHTML = "<li>No hay registros</li>";
    }

  } catch (error) {
    console.error("Error al cargar folios:", error);
    lista.innerHTML = "<li>Error al cargar</li>";
  }
}


  // Ejecutar al cargar la p√°gina
  window.addEventListener("DOMContentLoaded", cargarUltimosFolios);

  //----------------------BORRAR FOLIOS------------------------------
  function limpiarSeleccion() {
        document.getElementById("buscarId").value = "";

        // Si usas clases o efectos activos, puedes limpiarlos aqu√≠:
        document.querySelectorAll("#lista-folios li").forEach(el => el.classList.remove("activo"));
        document.getElementById("modificar-form").reset();
        updatePreview();
    }
    

    </script>

    </form>
        </div>

        <!-- √Årea de vista previa -->
        <div class="text-preview" id="resultado">
            <!-- La vista previa se actualizar√° autom√°ticamente -->


        </div>
        <div class="centrar-pantalla" >
            <h3 style="font-size: 16px;">COPIAR SCRIPT'S</h3>
            <button onclick="copiarSeccion('seccion-eta')">INICIAL</button>
            <br><br>
            <button onclick="copiarSeccion('seccion-sitio')">LLEGADA</button>
            <br><br>
            <button onclick="copiarSeccion('seccion-fallo')">FALLO</button>
            <br><br>
            <button onclick="copiarSeccion('seccion-final')">FINAL</button>
        </div>
    </div>

    <script>
//-----------------------------LLENADO DE MDRS
        async function cargarArchivoAutomatico1() {
            // Ruta del archivo .txt (en el mismo directorio del proyecto)
            const archivoRuta1 = './mdr.txt';

            // Usamos fetch para obtener el contenido del archivo
            try {
                const respuesta = await fetch(archivoRuta1);

                // Comprobar que el archivo se carg√≥ correctamente
                if (!respuesta.ok) {
                    throw new Error('No se pudo cargar el archivo.');
                }

                // Leer el contenido del archivo como texto
                const contenido = await respuesta.text();

                // Dividir el contenido por l√≠neas
                const lineas = contenido.split('\n');

                // Obtener el select
                //const select = document.getElementById('atendio_desp');

                // A√±adir las l√≠neas como opciones
                lineas.forEach(linea => {
                    const opcion = linea.trim();
                    if (opcion) {
                        const nuevaOpcion = document.createElement('option');
                        nuevaOpcion.value = opcion;
                        nuevaOpcion.textContent = opcion;
                        select.appendChild(nuevaOpcion);
                    }
                });
            } catch (error) {
               // console.error('Error al cargar el archivo:', error);
                //alert('Hubo un problema al cargar los mdr.');
            }
        }

        // Llamar a la funci√≥n al cargar la p√°gina
        cargarArchivoAutomatico1();


//------------------------------------------------------------------------- LLENADO DE TECNICOS


       async function cargarArchivoAutomatico() {
            // Ruta del archivo .txt (en el mismo directorio del proyecto)
            const archivoRuta = './tecnicos.txt';

            // Usamos fetch para obtener el contenido del archivo
            try {
                const respuesta = await fetch(archivoRuta);

                // Comprobar que el archivo se carg√≥ correctamente
                if (!respuesta.ok) {
                    throw new Error('No se pudo cargar el archivo.');
                }

                // Leer el contenido del archivo como texto
                const contenido = await respuesta.text();

                // Dividir el contenido por l√≠neas
                const lineas = contenido.split('\n');

                // Obtener el select
                const select = document.getElementById('nombre');

                // A√±adir las l√≠neas como opciones
                lineas.forEach(linea => {
                    const opcion = linea.trim();
                    if (opcion) {
                        const nuevaOpcion = document.createElement('option');
                        nuevaOpcion.value = opcion;
                        nuevaOpcion.textContent = opcion;
                        select.appendChild(nuevaOpcion);
                    }
                });
            } catch (error) {
                console.error('Error al cargar el archivo:', error);
               // alert('Hubo un problema al cargar los tecnicos.');
            }
        }

        // Llamar a la funci√≥n al cargar la p√°gina
        cargarArchivoAutomatico();

// LLENADO AUTOMATICO Y FUNCION DE SELECT CON BUSQUEDA CON SCRIPT2

	//NOMBRE DE TECNICO
 	$(document).ready(function() {
            $('#nombre').select2({
                placeholder: 'Selecciona una opci√≥n',
                allowClear: true,
          });

 	$('#nombre').on('change', function() {
                // Obtener el texto de la opci√≥n seleccionada
                var nombre = $(this).val();

		// Obtener el texto de la opci√≥n seleccionada
            

                // Actualizar el contenido de la vista previa
                updatePreview();
            });

            // Llamar al evento change al cargar la p√°gina para mostrar el texto por defecto
            $('#nombre').trigger('change');
		
        });

	    



 // AUTO LLENADO DE OLT SEGUN CLUSTER

        var numeros = {
            "ALDAMA": "ALDAMA_JUA",
            "ALDAMA_2": "ALDAMA_2_JUA",
            "BUENOS AIRES": "BUENOS_AIRES_JUA",
	        "BUENOS AIRES 2": "BUENOS_AIRES_2_JUA",
            "CARLOS AMAYA": "CARLOS_AMAYA_JUA",
            "EL VERGEL": "VERGEL_JUA",
            "GOMEZ MORIN": "GOMEZ_MORIN_JUA",
            "LOMAS DE MORELOS": "LOMAS_DE_MORELOS_JUA",
            "LOS CIPRESES": "CIPRESES_JUA",
            "MAYORCA": "MAYORCA_JUA",
            "NOGALES": "NOGALES_JUA",
            "OASIS": "OASIS_JUA",
            "SANTO DOMINGO": "SANTO_DOMINGO_JUA",
            "THOMPSON": "THOMPSON_JUA",
	        "THOMPSON 2": "THOMPSON_2_JUA",
            "TIERRA NUEVA": "HACIENDA_DE_LAS_TORRES_JUA",
            "TIERRA NUEVA 2": "HACIENDA_DE_LAS_TORRES_2_JUA",
            "SWITCH_CD_JUAREZ": "SWITCH_CD_JUAREZ",
            "GRANJERO_CDJRZ": "GRANJERO_CDJRZ"
        };

        function llenarNumero() {
            // Obtener el valor seleccionado del desplegable
            var seleccion = document.getElementById("cluster").value;

            // Verificar si la opci√≥n seleccionada tiene un n√∫mero asociado
            if (numeros.hasOwnProperty(seleccion)) {
                document.getElementById("olt").value = numeros[seleccion];
		updatePreview();

        	
            } else {
                document.getElementById("olt").value = ""; // Limpiar si no hay selecci√≥n
		updatePreview();

            }

        }


        // Selecciona los elementos de entrada
        const fechaInput = document.getElementById('fecha');
        const fechaTextoInput = document.getElementById('fecha-texto');

        // A√±ade un evento para actualizar el valor del campo de texto
        fechaInput.addEventListener('input', function() {
            const fechaSeleccionada = this.value;
            fechaTextoInput.value = fechaSeleccionada || 'No se ha seleccionado ninguna fecha.';
            document.getElementById('hr_llegada').value = fechaSeleccionada;
            document.getElementById('hr_desp').value = fechaSeleccionada;
            document.getElementById('hr_prov').value = fechaSeleccionada;
            document.getElementById('hr_med').value = fechaSeleccionada;
            document.getElementById('hr_final').value = fechaSeleccionada;

            updatePreview();
        });


	document.getElementById('proveedor').value = "GTB";
	document.getElementById('distrito').value = "JUAREZ";
	document.getElementById('estado').value = "CHIHUAHUA";

	
        function updatePreview() {
	



            // Obtener el valor del FOLIO del primer bloque
            var folio_ = document.getElementById('folio_').value;

            // Sincronizar el valor de los otros campos FOLIO
            document.getElementById('folio3_').value = folio_;
            document.getElementById('folio4').value = folio_;
            document.getElementById('sd').value = folio_; // Suponiendo que SD debe ser igual al folio


      	// Obtener el valor del PROVEEDOR del primer bloque
            var proveedor= document.getElementById('proveedor').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('proveedor2').value = proveedor;
            document.getElementById('proveedor4').value = proveedor;


	// Obtener el valor del DISTRITO del SEGUNDO bloque
            var distrito=document.getElementById('distrito').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('ciudad').value = distrito;

	// Obtener el valor del NOMBRE del SEGUNDO bloque
            var nombre=document.getElementById('nombre').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('atiende_nom_tec').value = nombre;


	// Obtener el valor de CAUSA DE DA√ëO del TERCER bloque
            var causa=document.getElementById('causa').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('causa_dano').value = causa;

	// Obtener el valor de CORDENADAS DA√ëO del TERCER bloque
            var coordenadas3=document.getElementById('coordenadas3').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('coordenadas_dano').value = coordenadas3;


	// Obtener el valor de NUMERO QR del TERCER bloque
            var qr=document.getElementById('qr').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('qr_2').value = qr;


    // Obtener el valor de MATERIALES del TERCER bloque
            var materiales=document.getElementById('materiales').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('material_utilizado').value = materiales;

    // Obtener el valor de COORDENADAS FALLO del TERCER bloque
            var coordenadas3 = document.getElementById('coordenadas3').value;
	// Sincronizar el valor de los otros campo
            document.getElementById('coordenadas_dano').value = coordenadas3;




            // Obtener los valores de los campos del primer bloque
            var eta = document.getElementById('eta').value;
            var proveedor = document.getElementById('proveedor').value;

            // Obtener los valores de los campos del segundo bloque
            var punto = document.getElementById('punto').value;
            var coordenadas = document.getElementById('coordenadas').value;
            var proveedor2 = document.getElementById('proveedor2').value;
            var distrito = document.getElementById('distrito').value;
	        var nombre = document.getElementById('nombre').value;

            // Obtener los valores de los campos del tercer bloque
            var causa = document.getElementById('causa').value;
            var accion = document.getElementById('accion').value;
            var calibre = document.getElementById('calibre').value;
            var coordenadas3 = document.getElementById('coordenadas3').value;
            var etr = document.getElementById('etr').value;
            var qr = document.getElementById('qr').value;
            var materiales = document.getElementById('materiales').value;

            // Obtener los valores de los campos del cuarto bloque
            var ciudad = document.getElementById('ciudad').value;
            var estado = document.getElementById('estado').value;
            var cluster = document.getElementById('cluster').value;
            var olt = document.getElementById('olt').value;
            var clientes = document.getElementById('clientes').value;
            var falla_r = document.getElementById('falla_r').value;
            var hr_desp = document.getElementById('hr_desp').value;
            var hr_prov = document.getElementById('hr_prov').value;
            var hr_llegada = document.getElementById('hr_llegada').value;
            var hr_med = document.getElementById('hr_med').value;
            var ubicacion_1er_2do = document.getElementById('ubicacion_1er_2do').value;
            var qr_2 = document.getElementById('qr_2').value;
            var ubicacion_dano = document.getElementById('ubicacion_dano').value;
            var coordenadas_dano = document.getElementById('coordenadas_dano').value;
            var desc_act = document.getElementById('desc_act').value;
            var potencia_inicial= document.getElementById('potencia_inicial').value;
            var potencia_final = document.getElementById('potencia_final').value;
            var trabajos_realizados = document.getElementById('trabajos_realizados').value;
            var hr_final = document.getElementById('hr_final').value;
            var causa_dano = document.getElementById('causa_dano').value;
            var atiende_nom_tec = document.getElementById('atiende_nom_tec').value;
            var proveedor4 = document.getElementById('proveedor4').value;
            var supervisor = document.getElementById('supervisor').value;
            var justificacion_sla = document.getElementById('justificacion_sla').value;
            var m_pausa = document.getElementById('m_pausa').value;
            var t_pausa = document.getElementById('t_pausa').value;
            var material_utilizado = document.getElementById('material_utilizado').value;

            // Actualizar el contenido del div de vista previa
            var resultado = document.getElementById('resultado');

            resultado.innerHTML = `
                <b>SCRIPT ETA:</b><div id="seccion-eta">FOLIO: *${folio_}*\nETA: *${eta}*\nPROVEEDOR: *${proveedor}*</div>

                <b>SCRIPT SITIO:</b><div id="seccion-sitio" style="white-space: pre-wrap;">SD: *${folio_}*\nSitio/punto de medici√≥n: *${punto}*\nCoordenadas: *${coordenadas}*\nProveedor: *${proveedor}*\nDistrito: *${distrito}*\nNombre: *${nombre}*</div>

                <b>SCRIPT FALLO:</b><div id="seccion-fallo" style="white-space: pre-wrap;">Folio: *${folio_}*\nCausa del da√±o: *${causa}*\nAcci√≥n correctiva: *${accion}*\nETR: *${etr}*\nCalibre de fo: *${calibre}*\nCoordenadas: *${coordenadas3}*\nNumero QR: *${qr}*\nMateriales a utilizar: *${materiales}*</div>

                <b>SCRIPT FINAL:</b><div id="seccion-final" style="white-space: pre-wrap;">FOLIO: *${folio_}*\nCIUDAD: *${ciudad}*\nESTADO: *${estado}*\nCLUSTER: *${cluster}*\nOLT: *${olt}*\nCLIENTES AFECTADOS: *${clientes}*\nFALLA_REPORTADA: *${falla_r}*\nFECHA_Y_HR_DE_ASG_DESP: *${hr_desp}*\nFECHA_Y_HR_DE_ASG_PROV: *${hr_prov}*\nHR_DE_LLEGADA_A_LA_ZONA: *${hr_llegada}*\nHR_DE_LA_1er_MEDICION: *${hr_med}*\nUBICACI√ìN_DE_1N_2N*${ubicacion_1er_2do}*\nQR DE SEGUNDO NIVEL: *${qr_2}*\nCAUSA DE DA√ëO: *${causa_dano}*\nUBICACI√ìN_DEL_DA√ëO: *${ubicacion_dano}*\nCOORDENADAS: *${coordenadas_dano}*\nDESCRIP_DE_ACTIVIDADES: *${desc_act}*\nPOTENCIA_INICIAL: *${potencia_inicial}*\nPOTENCIA_FINAL: *${potencia_final}*\nTRABAJOS_REALIZADOS: *${trabajos_realizados}*\nFECHA_HR_FINAL_DE_REPARACION: *${hr_final}*\nATIENDE_NOM_TEC: *${atiende_nom_tec}*\nPROVEEDOR: *${proveedor4}*\nSUPERVISOR DISTRITO: *${supervisor}*\nPAUSA HORA INICIAL Y FINAL: *${justificacion_sla}*\nMOTIVO DE PAUSA: *${m_pausa}*\nTIEMPO TOTAL DE PAUSA*${t_pausa}*\nMATERIAL UTILIZADO: *${material_utilizado}*</div>`;

           /* resultado.innerHTML = `<b>SCRIPT ETA:</b>\nFOLIO: *${folio_}*\nETA: *${eta}*\nPROVEEDOR: *${proveedor}*\n
            \n<b>SCRIPT SITIO:</b>\nSD: *${folio_}*\nSitio/punto de medici√≥n: *${punto}*\nCoordenadas: *${coordenadas}*\nProveedor: *${proveedor}*\nDistrito: *${distrito}*\nNombre: *${nombre}*\n
            \n<b>SCRIPT FALLO:</b>\nFolio: *${folio_}*\nCausa del da√±o: *${causa}*\nAcci√≥n correctiva: *${accion}*\nETR: *${etr}*\nCalibre de fo: *${calibre}*\nCoordenadas: *${coordenadas3}*\nNumero QR: *${qr}*\nMateriales a utilizar: *${materiales}*\n
           
            \n<b>SCRIPT FINAL:</b>\nFOLIO: *${folio_}*\nOT: *${ot}*\nCIUDAD: *${ciudad}*\nESTADO: *${estado}*\nCLUSTER: *${cluster}*\nOLT: *${olt}*\nCLIENTES AFECTADOS: *${clientes}*\nENLACES AFECTADOS: *${enlaces}*\nFALLA_REPORTADA: *${falla_r}*\nHR_DE_LLEGADA_A_LA_ZONA: *${hr_llegada}*\nUBICACI√ìN_DE_1N_2N*${ubicacion_1er_2do}*\nQR DE SEGUNDO NIVEL: *${qr_2}*\nCAUSA DE DA√ëO: *${causa_dano}*\nDIRECCION_DEL_DA√ëO: *${ubicacion_dano}*\nCOORDENADAS DEL DA√ëO: *${coordenadas_dano}*\nTRABAJOS_REALIZADOS(CONCEPTOS): *${trabajos_realizados}*\nPOTENCIA_FINAL: *${potencia_final}*\nATIENDE_NOM_TEC: *${atiende_nom_tec}*\nPROVEEDOR: *${proveedor4}*\nSUPERVISOR DISTRITO: *${supervisor}*\nPAUSA HORA INICIAL Y FINAL: *${justificacion_sla}*\nMOTIVO DE PAUSA: *${m_pausa}*\nTIEMPO TOTAL DE PAUSA*${t_pausa}*\nMATERIAL UTILIZADO: *${material_utilizado}*`;
        */}

        // Agregar eventos para actualizar la vista previa
        document.getElementById('folio_').addEventListener('input', updatePreview);
        document.getElementById('eta').addEventListener('input', updatePreview);
        document.getElementById('proveedor').addEventListener('input', updatePreview);
        document.getElementById('punto').addEventListener('input', updatePreview);
        document.getElementById('coordenadas').addEventListener('input', updatePreview);
        document.getElementById('proveedor2').addEventListener('input', updatePreview);
        document.getElementById('distrito').addEventListener('input', updatePreview);
        document.getElementById('nombre').addEventListener('input', updatePreview);
        document.getElementById('causa').addEventListener('input', updatePreview);
        document.getElementById('accion').addEventListener('input', updatePreview);
        document.getElementById('calibre').addEventListener('input', updatePreview);
        document.getElementById('coordenadas3').addEventListener('input', updatePreview);
        document.getElementById('qr').addEventListener('input', updatePreview);
        document.getElementById('etr').addEventListener('input', updatePreview);
        document.getElementById('ciudad').addEventListener('input', updatePreview);
        document.getElementById('estado').addEventListener('input', updatePreview);
        document.getElementById('cluster').addEventListener('input', updatePreview);
        document.getElementById('olt').addEventListener('input', updatePreview);
        document.getElementById('clientes').addEventListener('input', updatePreview);
        document.getElementById('falla_r').addEventListener('input', updatePreview);
        document.getElementById('hr_llegada').addEventListener('input', updatePreview);
        document.getElementById('ubicacion_1er_2do').addEventListener('input', updatePreview);
        document.getElementById('ubicacion_dano').addEventListener('input', updatePreview);
        document.getElementById('coordenadas_dano').addEventListener('input', updatePreview);
        document.getElementById('causa_dano').addEventListener('input', updatePreview);
        document.getElementById('potencia_final').addEventListener('input', updatePreview);
        document.getElementById('trabajos_realizados').addEventListener('input', updatePreview);
        document.getElementById('qr_2').addEventListener('input', updatePreview);
        document.getElementById('atiende_nom_tec').addEventListener('input', updatePreview);
        document.getElementById('proveedor4').addEventListener('input', updatePreview);
        document.getElementById('supervisor').addEventListener('input', updatePreview);
        document.getElementById('material_utilizado').addEventListener('input', updatePreview);
        document.getElementById('justificacion_sla').addEventListener('input', updatePreview);
        document.getElementById('materiales').addEventListener('input', updatePreview);
        document.getElementById('m_pausa').addEventListener('input', updatePreview);
        document.getElementById('t_pausa').addEventListener('input', updatePreview);
        document.getElementById('hr_desp').addEventListener('input', updatePreview);
        document.getElementById('hr_prov').addEventListener('input', updatePreview);
        document.getElementById('hr_med').addEventListener('input', updatePreview);
        document.getElementById('desc_act').addEventListener('input', updatePreview);
        document.getElementById('potencia_inicial').addEventListener('input', updatePreview);
        document.getElementById('hr_final').addEventListener('input', updatePreview);

        // Llamar a updatePreview al cargar la p√°gina para inicializar la vista previa
        updatePreview();

        function copiarSeccion(id) {
    var elemento = document.getElementById(id);

    if (!elemento) {
        alert("Secci√≥n no encontrada");
        return;
    }

    // Crear textarea temporal
    var tempTextarea = document.createElement("textarea");
    tempTextarea.value = elemento.innerText; // copiar solo texto plano
    document.body.appendChild(tempTextarea);

    tempTextarea.select();
    document.execCommand("copy");

    document.body.removeChild(tempTextarea);
   // alert("Secci√≥n copiada al portapapeles.");
}

    </script>

</body>
</html>
